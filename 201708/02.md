## å¸¦ä½ ç©è½¬ Surge

### ç®€å•äº†è§£

Surge æ˜¯åŸºäº iOS 9 æ–°å¢çš„â€œç½‘ç»œæ‰©å±•â€ï¼ˆNetwork Extensionï¼‰API[3] å¼€å‘çš„ä¸€æ¬¾ç½‘ç»œè°ƒè¯•å·¥å…·ã€‚ä½œä¸ºé¦–ä¸ªå€Ÿç”¨æ­¤è½¯ä»¶å¯ä½¿ç”¨ Shadowsocks çš„ iOS 9 åº”ç”¨ï¼Œä¸­å›½å¤§é™†ç½‘å‹å°†å…¶å¹¿æ³›è¿ç”¨äºçªç ´ç½‘ç»œå®¡æŸ¥ã€‚

Surge å¯åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚é˜»æŒ¡å¹¿å‘Šã€ç½‘ç»œè°ƒè¯•ã€æµé‡è·Ÿè¸ªã€ä»£ç†ä¸Šç½‘ç­‰ç­‰ã€‚

### å®‰è£…

Mac ç‰ˆä¸‹è½½[åœ°å€](https://nssurge.com/)ï¼Œä¸‹è½½å®Œæˆåè§£å‹æ–‡ä»¶å¤¹å¾—åˆ° Surge ç¨‹åºï¼Œå°†å…¶æ‹–æ”¾åˆ°åº”ç”¨ç¨‹åºä¸­æ‰“å¼€

å¯ç”¨ Surge åå‹¾é€‰ä¸‹æ‹‰èœå•ä¸­çš„ Set as System Proxy å³å¯è‡ªåŠ¨å‘ç³»ç»Ÿç½‘ç»œè®¾ç½®æ·»åŠ å¿…è¦çš„å‚æ•°ï¼Œå› ä¸ºéœ€è¦ä¿®æ”¹ç³»ç»Ÿç½‘ç»œè®¾ç½®ï¼Œé¦–æ¬¡å‹¾é€‰æ—¶éœ€è¦è¾“å…¥ç®¡ç†å‘˜å¯†ç è¿›è¡Œç¡®è®¤ï¼Œå»æ‰ Set as System Proxy çš„å‹¾é€‰ï¼Œä¼šæ¸…é™¤ç½‘ç»œè®¾ç½®ä¸­çš„ä»£ç†ç›¸å…³è®¾ç½®ã€‚

å¯ç”¨ã€Œç³»ç»Ÿåå¥½è®¾ç½®â€Šâ€”â€Šç½‘ç»œ - Wi-Fié«˜çº§ã€ HTTP å’Œ HTTPS ä»£ç†ï¼š 127.0.0.1:6152 ï¼ŒSOCKS ä»£ç†ä¸­è®¾ç½®ä¸º 127.0.0.1:6153

<img src="assets/02-1.png" width="520px" height="450px" />

æ·»åŠ å¿½ç•¥è¿™äº›ä¸»æœºä¸åŸŸçš„ä»£ç†è®¾ç½®ï¼ˆBypass Proxyï¼‰ï¼š127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local

### é…ç½®

Surge é»˜è®¤é…ç½®æ–‡ä»¶çš„è·¯å¾„åœ¨ /Users/Freelander/Documents/Surge ä¸‹ Default.confï¼Œæ–‡ä»¶å¤¹è¿˜æä¾›ç®€å•ä¸­æ–‡é…ç½®ä¾‹å­ï¼Œé‡Œé¢æœ‰å¾ˆå¤šæ³¨é‡Šæ•™ä½ å¦‚ä½•é…ç½®ã€‚

é…ç½®æ–‡ä»¶åŸºç¡€æœ€ç»ˆæˆ‘é€‰æ‹©äº†åœ¨ä¸€ä»½ [å¼€æºé…ç½®æ–‡ä»¶](https://github.com/stoneChen/Surge-config/blob/master/surge.conf) åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚å·²ä¸Šä¼ åˆ° [GitHub](https://github.com/Freelander/Blog/blob/master/201708/code/MySurge.conf)ã€‚

å°†å…¶å†…å®¹å¤åˆ¶åˆ°ä¸Šé¢æ‰€è¯´çš„è·¯å¾„ Default.conf æ–‡ä»¶ä¸­ï¼Œç„¶åä¿å­˜ç‚¹å‡»ä¸‹æ‹‰èœå•ä¸­çš„ Reload Profile from Fileï¼Œæ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å°±ç”Ÿæ•ˆäº†ã€‚

é¦–å…ˆæ¥çœ‹å¦‚ä½•é…ç½® ss ä»£ç†

```
[Proxy]
 ğŸ‡ºğŸ‡¸US-l = custom,${ss-server host},${ss-server port},${ss encrypt type},${ss-password},tls=true
 ğŸ‡ºğŸ‡¸US-m = custom,${ss-server host},${ss-server port},${ss encrypt type},${ss-password},tls=true
 ğŸ‡¯ğŸ‡µJP  = custom,${ss-server host},${ss-server port},${ss encrypt type},${ss-password},tls=true
 ğŸ‡¸ğŸ‡¬SG  = custom,${ss-server host},${ss-server port},${ss encrypt type},${ss-password},tls=true
 ğŸ‡©ğŸ‡ªDE  = custom,${ss-server host},${ss-server port},${ss encrypt type},${ss-password},tls=true
   
[Proxy Group]
Proxy = select,ğŸ‡ºğŸ‡¸US-l,ğŸ‡ºğŸ‡¸US-m,ğŸ‡¯ğŸ‡µ JP,ğŸ‡¸ğŸ‡¬SG,ğŸ‡©ğŸ‡ªDE
```
[Proxy]æ˜¯å…·ä½“çš„ä»£ç†é…ç½®ï¼Œå®ƒä¸‹é¢å°±æ˜¯ 5 ä¸ª ss æœåŠ¡å™¨èŠ‚ç‚¹, è¿™é‡Œåªæ˜¯ 5 ä¸ªå›½å®¶ä¾‹å­ï¼Œæ ¹æ®ä½ æ‹¥æœ‰çš„ ss è´¦å·æ•°æ¥å†³å®šï¼Œæ‹¥æœ‰å‡ ä¸ªè´¦å·å°±ç•™ä¸‹å…¶ä¸­å‡ ä¸ªå¯¹åº”å›½æ——é…ç½®å°±å¥½ã€‚è¡¨é¢ä¸Šçœ‹å°±æ˜¯ 5 ä¸ªé”®å€¼å¯¹(é”®å¯ä»¥è‡ªå®šä¹‰)ï¼Œé”®ä¸­åŠ ä¸Šå›½æ——å¯ä»¥å¾ˆç›´è§‚çš„åŒºåˆ†ä¸åŒå›½å®¶çš„ ss èŠ‚ç‚¹ï¼Œå€¼ä¸­çš„å˜é‡åˆ†åˆ«è¡¨ç¤ºï¼š
ss-server host: ss ä¸»æœºï¼Œip æˆ–åŸŸå
ss-server port: ss ä¸»æœºç«¯å£
ss encrypt type: åŠ å¯†æ–¹å¼
ss-password: ss å¯†ç 
custom ä¸èƒ½æ”¹ï¼Œæ˜¯ä¸€ä¸ªçº¦å®šç±»å‹(ss åè®®)ã€‚

ä¿å­˜ä¸Šé¢é…ç½®ï¼Œç‚¹å‡»ä¸‹æ‹‰èœå•ä¸­çš„ Reload Profile from Fileï¼Œé…ç½®ç”Ÿæ•ˆï¼Œå°±ä¼šå‡ºç°ä¸‹å›¾

<img src="assets/02-2.png" width="293px" height="445px" />

æ¥ç€æ‰“å¼€æµè§ˆå™¨è¾“å…¥ https://www.youtube.com/ å›è½¦
ä½ ä¼šå‘ç°å¤–é¢çš„ä¸–ç•Œå¦‚æ­¤ç²¾å½©

### å…±äº«ä¸Šç½‘

åœ¨å±€åŸŸç½‘å†…ï¼Œå…¶ä»–è®¾å¤‡æ— é¡»å†å®‰è£…ä»»ä½•è½¯ä»¶ï¼Œå³å¯ä¸æˆ‘ä¸€èµ·åˆ°å¤–é¢ä¸–ç•Œé¨æ¸¸ã€‚å…¶ä»–è®¾å¤‡åªéœ€è¦ç®€å•çš„åœ¨ wifi è®¾ç½®ä¸­æ·»åŠ ä¸€ä¸ª HTTP ä»£ç†å³å¯

å›¾ç‰‡æ¥æº [åœ°å€](https://medium.com/@scomper/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%85%B6%E4%BB%96%E8%AE%BE%E5%A4%87%E5%85%B1%E4%BA%AB%E4%B8%8A%E7%BD%91-dd29e18853da)

<img src="assets/02-4.png" width="681px" height="457px" />

### åŒæ—¶ä½¿ç”¨ Surge + Charles åˆ†æç½‘ç»œ

æ‰“å¼€ Charles çš„ External Proxy Settings è®¾ç½® Charles çš„å¤–éƒ¨ä»£ç†ä¸º Surge çš„ç«¯å£ï¼Œå³ä¸ä¸Šé¢ç³»ç»Ÿç½‘ç»œè®¾ç½®çš„ä»£ç†ä¸€è‡´

<img src="assets/02-3.png" width="435px" height="373px" />

### è¯­æ³•

// åŸºäºåŸŸååˆ¤æ–­å¹¶å±è”½ï¼ˆREJECTï¼‰è¯·æ±‚
DOMAIN,pingma.qq.com,REJECT
// åŸºäºåŸŸååç¼€åˆ¤æ–­å±è”½ï¼ˆREJECTï¼‰è¯·æ±‚
DOMAIN-SUFFIX,flurry.com,REJECT
// åŸºäºå…³é”®è¯åç¼€åˆ¤æ–­èµ°ä»£ç†ï¼ˆProxyï¼‰ï¼Œå¼ºåˆ¶ä¸å°Šé‡ç³»ç»Ÿä»£ç†çš„è¯·æ±‚èµ°
Packet-Tunnel-Provider DOMAIN-KEYWORD,google,Proxy,force-remote-dns
// åŸºäºåŸŸååç¼€åˆ¤æ–­è¯·æ±‚èµ°ç›´è¿ï¼ˆDIRECTï¼‰
DOMAIN-SUFFIX,126.net,DIRECT
// Telegram.app æŒ‡å®šâ€œno-resolveâ€Surge å¿½ç•¥è¿™ä¸ªè§„åˆ™ä¸åŸŸçš„è¯·æ±‚ã€‚
IP-CIDR,91.108.56.0/22,Proxy,no-resolve
// åˆ¤æ–­æ˜¯å¦æ˜¯å±€åŸŸç½‘ï¼Œå¦‚æœæ˜¯ï¼Œèµ°ç›´è¿
IP-CIDR,192.168.0.0/16,DIRECT
// åˆ¤æ–­æœåŠ¡å™¨æ‰€åœ¨åœ°ï¼Œå¦‚æœæ˜¯å›½å†…ï¼Œèµ°ç›´è¿
GEOIP,CN,DIRECT
// å…¶ä»–çš„å…¨éƒ¨èµ°ä»£ç†
FINAL,Proxy
// å…¶ä»–çš„å…¨éƒ¨ä¸èµ°ä»£ç†
FINAL,DIRECT

### æ³¨æ„å‘

å†™å®Œ [Rule] åé¢éœ€è¦åŠ 
```
[Rule] 

....

GEOIP,CN,DIRECT
FINAL,Proxy
```

### å‚è€ƒé“¾æ¥
* [Surge åŸç†ä¸å®ç°](https://medium.com/@Blankwonder/surge-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-8aa3304fb3bb)
* [Surge æ–°æ‰‹ä½¿ç”¨æŒ‡å—](https://medium.com/@scomper/surge-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-a1533c10e80b)
* [Surge å®˜æ–¹é…ç½®æ•™ç¨‹](https://manual.nssurge.com/overview/configuration.html)
* [Surge for Mac 2 åˆä½“éªŒä¸æ•™ç¨‹](http://cloudstone.xin/2016/10/31/Mac-Surge-2-%E5%88%9D%E4%BD%93%E9%AA%8C/)
* [Surge config](https://github.com/lhie1/Surge)
* [Surge for Mac ç®€æ˜æŒ‡å—](https://medium.com/@scomper/surge-for-mac-%E7%AE%80%E6%98%8E%E6%8C%87%E5%8D%97-f6f357b8f09c)
* [å±€åŸŸç½‘å…¶ä»–è®¾å¤‡å…±äº«ä¸Šç½‘](https://medium.com/@scomper/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%85%B6%E4%BB%96%E8%AE%BE%E5%A4%87%E5%85%B1%E4%BA%AB%E4%B8%8A%E7%BD%91-dd29e18853da)
* [è§£å†³Surge for Mac+CharlesåŒæ—¶åˆ†æç½‘ç»œè¯·æ±‚çš„åŠæ³• ](https://github.com/wujunchuan/wujunchuan.github.io/issues/1)